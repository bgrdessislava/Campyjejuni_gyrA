
####Step 1 
#connecting to the VPN -- Pooh ! 290
ssh spet4850@linux.ox.ac.uk

#connecting to the cluster Corona ------290  
ssh -X spet4850@arc-login.arc.ox.ac.uk

#Step 2 - Synching my files to ARC (do this from my computer)
rsync --progress -arzv -e 'ssh -o "ProxyCommand ssh -A spet4850@linux.ox.ac.uk -W %h:%p"' CAMP*.xmfa spet4850@arcus-b.arc.ox.ac.uk:/home/spet4850/campy_analysis/Data/
rsync --progress -arzv -e 'ssh -o "ProxyCommand ssh -A spet4850@linux.ox.ac.uk -W %h:%p"' separated_aligned_fasta.csv.gz spet4850@arcus-b.arc.ox.ac.uk:/home/spet4850/campy_analysis/Data/
rsync --progress -arzv -e 'ssh -o "ProxyCommand ssh -A spet4850@linux.ox.ac.uk -W %h:%p"' coreMLST_2016only.fas spet4850@arcus-b.arc.ox.ac.uk:/home/spet4850/campy_analysis/data/2016_coreMLST_aligned/
rsync --progress -arzv -e 'ssh -o "ProxyCommand ssh -A spet4850@linux.ox.ac.uk -W %h:%p"' CC353_alignedto11168.fas spet4850@arcus-b.arc.ox.ac.uk:/data/zool-microbe-genomics/spet4850/campy_analysis/data/CC353/
rsync --progress -arzv -e 'ssh -o "ProxyCommand ssh -A spet4850@linux.ox.ac.uk -W %h:%p"' CC353_alignedto11168.fas spet4850@arcus-b.arc.ox.ac.uk:/data/zool-microbe-genomics/spet4850/campy_analysis/data/CC353/
rsync --progress -arzv -e 'ssh -o "ProxyCommand ssh -A spet4850@linux.ox.ac.uk -W %h:%p"' Saureus.fasta spet4850@arcus-b.arc.ox.ac.uk:/data/zool-microbe-genomics/spet4850/campy_analysis/ClonalFrameML2/
rsync --progress -arzv -e 'ssh -o "ProxyCommand ssh -A spet4850@linux.ox.ac.uk -W %h:%p"' CC353_rMLST_aligned.fas spet4850@arc-login.arc.ox.ac.uk:/data/zool-microbe-genomics/spet4850/campy_analysis/data/CC353/
rsync --progress -arzv -e 'ssh -o "ProxyCommand ssh -A spet4850@linux.ox.ac.uk -W %h:%p"' CC353_alignedto_coreMLST.fas.gz spet4850@arc-login.arc.ox.ac.uk:/data/zool-microbe-genomics/spet4850/campy_analysis/data/CC353/
rsync --progress -arzv -e 'ssh -o "ProxyCommand ssh -A spet4850@linux.ox.ac.uk -W %h:%p"' CC353_aligned_coreMLST_OdileAdvice_core.fas spet4850@arc-login.arc.ox.ac.uk:/data/zool-microbe-genomics/spet4850/campy_analysis/data/CC353/
rsync --progress -arzv -e 'ssh -o "ProxyCommand ssh -A spet4850@linux.ox.ac.uk -W %h:%p"' CC353_aligned_coreMLST_OdileAdvice_core-deduplicated.fasta.gz spet4850@arc-login.arc.ox.ac.uk:/data/zool-microbe-genomics/spet4850/campy_analysis/data/CC353/
rsync --progress -arzv -e 'ssh -o "ProxyCommand ssh -A spet4850@linux.ox.ac.uk -W %h:%p"' year_df_humanfecesONLY_ID.csv spet4850@arc-login.arc.ox.ac.uk:/data/zool-microbe-genomics/spet4850/campy_analysis/data/
rsync --progress -arzv -e 'ssh -o "ProxyCommand ssh -A spet4850@linux.ox.ac.uk -W %h:%p"' 13672_isolate_unaligned.fasta.gz spet4850@arc-login.arc.ox.ac.uk:/data/zool-microbe-genomics/spet4850/campy_analysis/data/
rsync --progress -arzv -e 'ssh -o "ProxyCommand ssh -A spet4850@linux.ox.ac.uk -W %h:%p"' CAMP*.xmfa.gz spet4850@arc-login.arc.ox.ac.uk:/data/zool-microbe-genomics/spet4850/campy_analysis/data/13672_analysis/
rsync --progress -arzv -e 'ssh -o "ProxyCommand ssh -A spet4850@linux.ox.ac.uk -W %h:%p"' newick_concatination.slurm spet4850@arc-login.arc.ox.ac.uk:/data/zool-microbe-genomics/spet4850/campy_analysis/data/13672_analysis/
rsync --progress -arzv -e 'ssh -o "ProxyCommand ssh -A spet4850@linux.ox.ac.uk -W %h:%p"' pairwise.py spet4850@arc-login.arc.ox.ac.uk:/data/zool-microbe-genomics/spet4850/campy_analysis/data/13672_analysis/


#Step 3 - Make a file using nano and print the Step 4 


#Step 4 - Slurm Script 

#!/bin/bash


#SBATCH --job-name=fasttree_%j
#SBATCH --nodes=1
#SBATCH --ntasks=1
#SBATCH --cpus-per-task=4
#SBATCH --time=0-2:00:00
#SBATCH --chdir=/data/zool-microbe-genomics/spet4850/campy_analysis/data
#SBATCH --output=/data/zool-microbe-genomics/spet4850/campy_analysis/logs/fasttree_%j.out
#SBATCH --error=/data/zool-microbe-genomics/spet4850/campy_analysis/logs/fasttree_%j.err
#SBATCH --mail-type=ALL
#SBATCH --mail-user=spet4850@spc.ox.ac.uk

module purge
module load slurm
module load fasttree/2.1.9

FastTreeMP -gtr -nt  < CC353_alignedto11168.fas > CC353_alignedto11168.fas.nwk

FastTreeMP -gtr -nt  < 13672_isolates.fas > 13672_isolates.fas.nwk


#Step 5 sbatch and run the job
sbatch CC353_reference11168aligned_fasttree.slurm

#Step 6 check the condition of the work
sacct -j 2525521  #(you get number for your job)
sacct -j 2525589
sacct -j 705280 #fasttree for odiles help CC353
sacct -j 666265  #CC353 isolates along the 11168 
sacct -j 540673  #example clonalframe
sacct -j 541195 #CC353 coreMLST aligned - fasttree
sacct -j 666264 #clonalframeML for CC353 on coreMLST
sacct -j 651719 #re-running fasttree
sacct -j 666267 #re-running the clonalframeML with coreMLST aligned
sacct -j 2132188 #running 13672 alighnment mafft

#Step 7 after submitted and wanting to take the files back into my computer [use this command in my computer]
scp -r spet4850@gateway.arc.ox.ac.uk:/data/zool-microbe-genomics/spet4850/campy_analysis/ClonalFrameML2/ClonalFrameML/example.output.emsim.txt  /Users/user/Documents/HPC/clonalframe_example
scp -r spet4850@gateway.arc.ox.ac.uk:/data/zool-microbe-genomics/spet4850/campy_analysis/ClonalFrameML2/ClonalFrameML  /Users/user/Documents/HPC/clonalframe_example
scp -r spet4850@gateway.arc.ox.ac.uk:/data/zool-microbe-genomics/spet4850/campy_analysis/data/CC353/Aligned_11168_files  /Users/user/Documents/HPC/CC353_aligned_11168
scp -r spet4850@gateway.arc.ox.ac.uk:/data/zool-microbe-genomics/spet4850/campy_analysis/data/CC353/Aligned_11168_files  /Users/user/Documents/HPC/CC353_aligned_11168
scp -r spet4850@gateway.arc.ox.ac.uk:/data/zool-microbe-genomics/spet4850/campy_analysis/data/CC353/Checking_CC353odile_coreMLST/odile_coreMLST_CC353.zip /Users/user/Documents/HPC
scp -r spet4850@gateway.arc.ox.ac.uk:/data/zool-microbe-genomics/spet4850/campy_analysis/data/CC353/CC353_removedduplicate/removed_duplicated.zip /Users/user/Documents/HPC
scp spet4850@arc-login.arc.ox.ac.uk:/data/zool-microbe-genomics/spet4850/campy_analysis/data/13672_analysis/MeanBranchLength.csv .
scp spet4850@arc-login.arc.ox.ac.uk:/data/zool-microbe-genomics/spet4850/campy_analysis/data/13672_analysis/Average_matrix.npy .
scp spet4850@arc-login.arc.ox.ac.uk:/data/zool-microbe-genomics/spet4850/campy_analysis/logs/pairwise_matrix_2203431.out tree_label.txt






#Good way to check the err file
tail -f fasttree_320972.err

#Other good lines
module list #gives you the modules that are currently running
module avail #gives you the module available in the arcus-b
squeue | grep spet4850 #To check where my work is in the code



#Clonalframe Scripts
Rscript cfml_results_2.R example.output core-sites.txt

Rscript cfml_results_2.R CC353_alignedto11168_clonalframe_output.em.txt 
